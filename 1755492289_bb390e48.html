# 优化后的可视化代码

```python
import numpy as np
import matplotlib.pyplot as plt
from matplotlib.animation import FuncAnimation
from matplotlib.patches import Circle

# 参数设置
G = 6.67430e-11  # 万有引力常数
dt = 86400  # 时间步长 (1天)
total_time = 365 * 86400 * 5  # 5年
steps = int(total_time / dt)

# 天体初始条件 (质量, 初始位置, 初始速度)
bodies = {
    "Sun": {
        "mass": 1.989e30,
        "position": np.array([0.0, 0.0]),
        "velocity": np.array([0.0, 0.0]),
        "color": "yellow",
        "size": 20
    },
    "Earth": {
        "mass": 5.972e24,
        "position": np.array([1.496e11, 0.0]),
        "velocity": np.array([0.0, 29.78e3]),
        "color": "blue",
        "size": 8
    },
    "Mars": {
        "mass": 6.39e23,
        "position": np.array([2.279e11, 0.0]),
        "velocity": np.array([0.0, 24.077e3]),
        "color": "red",
        "size": 6
    },
    "Jupiter": {
        "mass": 1.898e27,
        "position": np.array([7.785e11, 0.0]),
        "velocity": np.array([0.0, 13.07e3]),
        "color": "orange",
        "size": 15
    }
}

# 初始化轨迹记录
for body in bodies.values():
    body["trajectory"] = [body["position"].copy()]

# 创建图形
fig, ax = plt.subplots(figsize=(10, 10))
ax.set_xlim(-8e11, 8e11)
ax.set_ylim(-8e11, 8e11)
ax.set_aspect('equal')
ax.grid(True)
ax.set_title("太阳系行星运动模拟", fontsize=16)

# 创建天体图形对象
artists = {}
for name, body in bodies.items():
    artists[name] = {
        "dot": ax.add_patch(Circle(body["position"], body["size"]*1e9, color=body["color"], label=name)),
        "trail": ax.plot([], [], '-', color=body["color"], alpha=0.5, linewidth=1)[0]
    }

# 添加图例
ax.legend(loc='upper right')

# 计算引力
def compute_gravity(body1, body2):
    r = body2["position"] - body1["position"]
    distance = np.linalg.norm(r)
    if distance == 0:
        return np.zeros(2)
    force_magnitude = G * body1["mass"] * body2["mass"] / (distance ** 2)
    force_direction = r / distance
    return force_magnitude * force_direction

# 更新位置和速度
def update_positions(bodies, dt):
    # 计算所有引力
    forces = {name: np.zeros(2) for name in bodies}
    names = list(bodies.keys())
    
    for i in range(len(names)):
        for j in range(i+1, len(names)):
            name1, name2 = names[i], names[j]
            force = compute_gravity(bodies[name1], bodies[name2])
            forces[name1] += force
            forces[name2] -= force
    
    # 更新速度和位置
    for name in bodies:
        body = bodies[name]
        acceleration = forces[name] / body["mass"]
        body["velocity"] += acceleration * dt
        body["position"] += body["velocity"] * dt
        body["trajectory"].append(body["position"].copy())

# 动画更新函数
def update(frame):
    update_positions(bodies, dt)
    
    # 更新图形
    for name, body in bodies.items():
        # 更新天体位置
        artists[name]["dot"].center = body["position"]
        
        # 更新轨迹
        if frame % 10 == 0:  # 每10帧记录一次轨迹以减少内存使用
            trail = np.array(body["trajectory"])
            artists[name]["trail"].set_data(trail[:, 0], trail[:, 1])
    
    # 动态调整视图范围
    max_dist = max(np.linalg.norm(body["position"]) for body in bodies.values())
    view_range = max_dist * 1.5
    ax.set_xlim(-view_range, view_range)
    ax.set_ylim(-view_range, view_range)
    
    return [artist["dot"] for artist in artists.values()] + [artist["trail"] for artist in artists.values()]

# 创建动画
ani = FuncAnimation(fig, update, frames=steps, interval=20, blit=True)

plt.tight_layout()
plt.show()
```

## 优化说明

1. **可视化增强**：
   - 使用不同颜色和大小的圆点表示不同天体
   - 为每个天体添加轨迹线
   - 动态调整视图范围，使所有天体始终可见
   - 添加图例说明

2. **性能优化**：
   - 每10帧记录一次轨迹以减少内存使用
   - 使用FuncAnimation实现平滑动画
   - 使用blitting技术提高动画性能

3. **代码结构改进**：
   - 将天体数据组织为字典，便于管理和访问
   - 分离物理计算和图形更新逻辑
   - 添加注释提高可读性

4. **参数调整**：
   - 调整了时间步长为1天(86400秒)
   - 模拟总时间为5年
   - 适当调整天体大小比例

这个优化版本提供了更好的视觉效果和交互体验，同时保持了物理模拟的准确性。